<p id="notice"><%= notice %></p>
<a href="#" class="js-next" data-id="<%=@movie.id%>">Next Movie>>></a>

<p class="movieTitle">
  <h3><strong>Title:</strong>
  <%= @movie.title %></h3>
</p>

<p class="movieYear">
  <strong>Year:</strong>
  <%= @movie.year %>
</p>

<p class="movieSynopsis">
  <strong>Synopsis:</strong>
  <%= @movie.synopsis %>
</p>

<p class="movieRating">
  <strong>Rating:</strong>
  <% if @movie.rating.nil?  %>
  <em>Movie not yet reviewed</em>
    <% else %>
  <%= number_with_precision(@movie.rating, precision: 1)  %> from <%= @movie.reviews.size %> review(s).
  <% end %>
</p>

<p class="movieUser">
  <strong>Last updated by:</strong>
  <em><%= @movie.user.email %></em>
</p>

<hr class="style1">
<div id="reviewSection">
  <strong>Reviews:</strong>
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Title of Review</th>
        <th>Reviewer</th>
        <th>Rating</th>
        <th colspan="3"></th>
      </tr>
    </thead>
  <tbody>
    <% @movie.reviews.each do |review| %>
      <tr>
        <td><strong><%= review.title%></strong></td>
        <td><%= review.user.email %></td>
        <td><%= number_with_precision(review.rating, precision: 1) %></td>
        <td><%= link_to 'Show', ([@movie,review]) %></td>
        <% if current_user.id == review.user_id %>
        <td><%= link_to 'Edit', edit_movie_review_path(@movie,review) %></td>
        <td><%= link_to 'Destroy', ([@movie,review]), method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to 'Add a Review', new_movie_review_path(@movie) %> |
<%= link_to 'Edit Movie', edit_movie_path(@movie) %> |

<% if current_user.id == @movie.user_id %>
 <%= link_to 'Destroy', @movie, method: :delete, data: { confirm: 'Are you sure?' } %>
<% end %>
</div>
<br>

<%= link_to 'Back', movies_path %>


<script type="text/javascript" charset="utf-8">
$(function () {
  $(".js-next").on("click", function(e) {
    var nextId = parseInt($(".js-next").attr("data-id")) + 1;
    $.get("/movies/" + nextId + ".json", function(data) {
      $("h3").html('<h3><strong>Title:</strong> '+ data["title"] + '</h3>');
      $(".movieYear").html('<strong>Year:</strong> '+ data["year"]);
      $(".movieSynopsis").html('<strong>Synopsis:</strong> '+ data["synopsis"]);
      $(".movieRating").html('<strong>Rating:</strong> '+ data["rating"]);
      $(".movieUser").html('<strong>Added by:</strong> '+ data["user"]["email"]);
      // re-set the id to current on the link
      $(".js-next").attr("data-id", data["id"]);
      //Hide irrelevant details
      //$("#reviewSection.table").hide();


    });
    document.getElementById('reviewSection').style.display="none";
  });
});
</script>
